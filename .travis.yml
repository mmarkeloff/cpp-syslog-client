language: cpp

branches:
  only:
    - main

compiler:
    - gcc

services:
    - docker

addons:
  apt:
    packages:
      - doxygen

script:
    - doxygen Doxyfile

deploy:
  provider: pages
  local_dir: docs/html
  github_token: $GH_REPO_TOKEN
  on:
    branch: main

before_script:
    - docker build -t cpp-syslog-client -f test_pkg/Dockerfile .
    - mkdir test/unit/build && cd test/unit/build
    - cmake ..
    - make

jobs:
  include:
    - stage: "Unit tests"
      name: "Unit tests"
      script: make test
    - stage: "Integration tests"
      name: "Integration tests"
      script: docker run cpp-syslog-client
