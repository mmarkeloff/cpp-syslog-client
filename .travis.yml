language: cpp

branches:
  only:
    - main

compiler:
    - gcc

services:
    - docker

addons:
  apt:
    packages:
      - doxygen
      - doxygen-doc
      - doxygen-latex
      - doxygen-gui
      - graphviz

before_script:
    - doxygen Doxyfile
    - docker build -t cpp-syslog-client -f test_pkg/Dockerfile .

jobs:
  include:
    - stage: "Build"
      name: "Sample project"
      script: ./ci/sample.sh
    - stage: "Test"
      name: "Unit tests"
      script: ./ci/test.sh
    - stage: "Test"
      name: "Integration tests"
      script: docker run cpp-syslog-client

deploy:
  provider: pages
  skip_cleanup: true
  local_dir: html
  github_token: $GH_REPO_TOKEN
  on:
    branch: main
